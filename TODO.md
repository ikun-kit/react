# Granule 包改进计划

## 🐛 Bug 修复

- [x] 修复错误消息中的 "ScopeMap" 字样
- [ ] 修复 useGranuleScopeItem.ts 中的 `// TODO: move` 注释

## 🚀 功能增强

### 位置插入功能

- [ ] 实现 `beforeId` 的 DOM 插入位置支持
- [ ] 添加 `insertBefore`, `insertAfter` API
- [ ] 支持索引位置插入 `insertAt(index, item)`

### 批量操作 API

- [ ] 实现 `insertMany(items)` 批量插入
- [ ] 实现 `deleteMany(ids)` 批量删除
- [ ] 实现 `updateMany(updates)` 批量更新
- [ ] 实现 `clear()` 清空所有项目
- [ ] 实现 `replace(items)` 替换所有项目

### 查询和过滤

- [ ] 添加 `findItem(predicate)` 查找功能
- [ ] 添加 `filterItems(predicate)` 过滤功能
- [ ] 添加 `sortItems(compareFn)` 排序功能

## ⚡ 性能优化

### 状态查找优化

- [ ] 为 `useGranuleScopeItem` 添加状态缓存机制
- [ ] 实现 ID 到索引的映射（Map<K, number>）
- [ ] 避免频繁的 `find` 操作

### 事件系统优化

- [ ] 实现事件监听器去重
- [ ] 添加事件监听器自动清理机制
- [ ] 优化批量事件通知

## 🔧 开发体验

### 类型安全

- [ ] 完善 Observable 的类型推导
- [ ] 添加运行时类型检查选项
- [ ] 改进泛型约束和类型提示

### 错误处理

- [ ] 添加更详细的错误信息
- [ ] 实现错误边界处理
- [ ] 添加开发模式警告

### 调试支持

- [ ] 集成 React DevTools
- [ ] 添加状态变化日志
- [ ] 实现时间旅行调试

## 🏗️ 架构改进

### 插件系统

- [ ] 设计中间件架构
- [ ] 支持生命周期钩子插件
- [ ] 实现持久化插件
- [ ] 添加日志插件

### 边界情况处理

- [ ] 空数组初始化的特殊处理
- [ ] 重复 ID 的严格检查和警告
- [ ] 无效操作的容错处理
- [ ] 内存泄露检测和预防

## 📚 文档和测试

### 文档完善

- [ ] API 参考文档
- [ ] 使用示例和最佳实践
- [ ] 迁移指南
- [ ] 性能调优指南

### 测试覆盖

- [ ] 单元测试覆盖所有 API
- [ ] 集成测试覆盖常见场景
- [ ] 性能基准测试
- [ ] 内存泄露测试

## 🎯 新特性

### 数据持久化

- [ ] localStorage 适配器
- [ ] sessionStorage 适配器
- [ ] IndexedDB 适配器
- [ ] 自定义存储适配器接口

### 响应式特性

- [ ] 计算属性支持
- [ ] 依赖追踪
- [ ] 自动更新机制

### 跨组件通信

- [ ] 全局状态管理
- [ ] 跨 Provider 通信
- [ ] 事件总线机制

---

## 优先级说明

- **High**: 影响核心功能或用户体验的问题
- **Medium**: 重要的功能增强和性能优化
- **Low**: nice-to-have 的特性和改进

请按优先级逐步实现这些改进。
